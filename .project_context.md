# Project Context: Google Photos Backup

## 0. Project requirements provided by the user
Quiero hacer una aplicación en linux, que se pueda distribuir para instalar con apt en Debian o con opciones similares en Red Hat y otros. Será en Go y la desarrollaremos en Mac y luego la portaremos a Linux



Se trata de una aplicación sin interfaz de escritorio. La configuración será mediante ficheros en /etc/



La aplicación se llamará google-photos-backup. Realizará un backup local de todas las fotos y videos en google photos para una determinada cuenta. Comprobará las imágenes de las que ya existe backup y añadirá las nuevas (no eliminará imágenes del backup que se hayan borrado de google photos). Utilizará la API de google photos para localizar todas las imágenes, pero luego utilizará un acceso tipo headless-browser o wget o similar para descargar las imágenes a tamaño completo (la API no permite descargarla a tamaño completo).



De forma más detallada, debe hacer lo siguiente

- Leerá los datos necesarios del fichero de configuración: usuario, clave de API y cualquier otra cosa que haga falta

- Dispondrá de una herramienta configurador que pedirá los datos necesarios y los almacenará en el fichero de configuración y que, cuando sea necesario, lanzará un navegador web para logarse con la cuenta de google y dar permisos a la aplicación para acceder con ese usuario

- Creará copia de seguridad de todas las imágenes y vídeos de google photos

- Guardará un índice para saber de qué imágenes ya se ha creado copia de seguridad y no tener que estar comprobando una por una, y solo añadir las nuevas.

- Ese índice también le permitirá marcar imágenes de las que hay un backup pero se han eliminado de google photos, para que el usuario pueda comprobarlas y ver si quiere mantenerlas o eliminarlas

- Tendrá una opción para actualizar el índice, que comprobará (a) si se han eliminado ficheros en el backup y en ese caso los borrará del índice, (b) si se han eliminado fotos de google photos, en cuyo caso los marcará en el índice como eliminados de google photos y (c) si se han añadido nuevas fotos a google photos, en cuyo caso las añadirá en el índice como pendientes de descarga.

- Tendrá una opción para rehacer el índice, que volverá a usar la API y todos los archivos para crear el índice indicando que imágenes se han borrado en google photos y qué imágenes ya hay copia de seguridad, y de cuales no hay aún copia de seguridad (pero ya están en google photos)

- Tendrá una opción para descargar las fotos que estén pendientes de descarga según el índice

- Tendrá una opción para eliminar del backup las fotos que se hayan eliminado de google drive. Salvo que se use una opción de Force, esta opción preguntará imagen por imagen y permitirá ver las imágenes (abriendo una aplicación para mostrarla) para que el usuario pueda decidir si las elimina o no

- Tendrá una opción para realizar o actualizar el backup. Esta es la opción principal y es la que se usará desde un cron de forma regular

- No quiero usar SQLite. ¿Es neecesario? Si es posible y no hay una diferencia muy importante, preferiría guardar los índices en ficheros planos (cada linea una foto, con sus propiedades o similar). ¿qué te parece?

- Sí o sí habrá que usar algún tipo de scrapping. Ya he comprobado que la API no permite descargar los ficheros originales a máxima calidad

- Usaré MacOs con visual studio para el desarrollo. Cuando esté terminado, lo portaré a linux.

## 1. Project Overview
CLI application to perform local and incremental backups of Google Photos using a hybrid strategy:
*   **API**: Used for listing items and fetching metadata (reliable incremental sync).
*   **Browser (go-rod)**: Used for downloading files to ensure maximum quality and preserve metadata (bypassing API compression).

## 2. Technical Architecture
*   **Language**: Go (1.25+)
*   **CLI Library**: Cobra
*   **Configuration**: Viper (`~/.config/google-photos-backup/config.yaml`)
*   **Browser Automation**: go-rod (Connects to Chrome/Chromium)
*   **Data Storage**: Local JSONL index (`index.jsonl`) to track downloaded IDs.

## 3. Development Workflow
*   **Branching**: Use `feature/<name>` for new developments.
*   **Commits**: Semantic messages (`feat:`, `fix:`, `docs:`).
*   **Documentation**:
    *   **CRITICAL**: Maintain parity between `README.md` (English) and `README.es.md` (Spanish).
    *   Update the "Developer Info" file list in READMEs whenever files are created/deleted.

## 4. File Structure Reference
*   `cmd/`: Entry points for commands (`configure`, `sync`, `root`).
*   `internal/api/`: Google Photos API client (Listing, Metadata).
*   `internal/auth/`: OAuth2 authentication.
*   `internal/downloader/`: Browser automation logic (`browser.go`).
*   `internal/index/`: Local database logic.

## 5. Current Session Status
*   **Active Branch**: `main` (or current feature branch).
*   **Recent Progress**:
    *   Implemented `internal/downloader/browser.go` (go-rod engine).
    *   Updated READMEs with "Developer Info".
    *   Verified `cmd/sync.go` listing logic.
*   **Immediate Next Tasks**:
    1.  **Create `cmd/login.go`**: A command to launch a non-headless browser for the user to sign in. This establishes the session cookies for the downloader.
    2.  **Update `cmd/sync.go`**: Integrate the `downloader` package to download files found by the API listing.
    3.  **Update READMEs**: Document the new `login` command.
